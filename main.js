var dictText = '{"DQ112922": "DR Congo", "EF060350": "Somalia", "EF060354": "Israel: Dimona", "DQ112720": "Dominican Republic", "DQ112721": "Dominican Republic", "DQ112722": "Dominican Republic", "AY339533": "Finland", "AF381999": "Jordan", "AY339447": "Finland", "AY339446": "Finland", "AP008915": "Japan", "DQ112850": "DR Congo", "DQ112851": "DR Congo", "DQ112858": "China", "DQ112859": "China", "AY738992": "Georgia", "AP008728": "Japan", "EF060362": "Iraq", "EF060361": "Morocco: Marrakesh", "AP008643": "Japan", "AY195753": "North Korea: Pyongyang", "AY275535": "Mauritania", "AY289072": "Southern India", "DQ137398": "Papua New Guinea: West New Britain ", "AY289098": "India: Mumbai", "AF382008": "Morocco: Marrakesh", "AF382009": "Spain: Canary Islands, Tenerife", "AF381982": "Spain: Canary Islands, Tenerife", "AF381981": "Mauritania", "AF382000": "Jordan", "AF382006": "Spain: Leon", "AF382007": "Spain: Leon", "AF382004": "Spain: Leon", "AY195763": "North Korea: Pyongyang", "DQ902695": "Sweden: Norrbotten", "DQ902694": "Sweden: Norrbotten", "AY275530": "Spain: Galicia", "AY275531": "Mauritania", "AY275533": "Spain: Canary Islands", "AY882416": "Ethiopia", "AY275537": "Spain: Canary Islands", "EF060340": "Egypt: Luxor", "DQ112754": "Australia", "AY289074": "Southern Indian", "AY289075": "Papua New Guinea", "AY882390": "Pakistan", "AY289073": "Southern India", "AY289070": "Filippines", "AY289071": "Kannada", "AY275528": "Spain: Canary Islands", "AF382011": "Spain", "AF382010": "Spain: Canary Islands, Hierro", "AF382013": "India", "AF382012": "Philippines: Manila", "AY738971": "Georgia", "AY195773": "Germany", "DQ372881": "Vanuatu", "DQ372880": "Vanuatu", "DQ372883": "Vanuatu", "DQ372885": "Samoa", "DQ372884": "Cook Islands", "AY738961": "Iraq", "DQ372886": "Tonga", "DQ137400": "Papua New Guinea: East New Britain, Watwat", "DQ137401": "Papua New Guinea: East New Britain, Malasait", "DQ137402": "Papua New Guinea: East New Britain", "DQ137403": "Papua New Guinea: East New Britain", "DQ137404": "Papua New Guinea: New Britain", "DQ137405": "Papua New Guinea: South Bougainville", "DQ137409": "Papua New Guinea: East New Britain", "EF064324": "Nigeria", "EF064323": "Ethiopia", "EF064321": "Algeria", "AY882389": "Ethiopia", "AY289069": "Cook Islander", "AY289068": "Cook Islander", "AY882385": "Yemen", "AY882383": "Yemen", "EF060316": "Egypt: Luxor", "EF060315": "Egypt: Siwa", "EF060314": "Egypt: Siwa", "EF060313": "Italy: Sardinia", "EF060319": "Italy: Sardinia", "AY963572": "Cambodia", "DQ112760": "Norway", "DQ112761": "Norway", "DQ112762": "Norway", "AY289094": "Samoan", "AY289095": "India: Mumbai", "AY289096": "India: Mumbai", "AY289093": "Samoan", "EF064331": "Tunisia", "EF064330": "Nigeria", "EF064333": "Tunisia", "EF064332": "Italy", "EF064335": "Italy: Sardinia", "AF381998": "Jordan", "EF064339": "France", "DQ372876": "Micronesia Majuro Atoll", "DQ372874": "Micronesia", "DQ372875": "Micronesia", "AY289080": "Papua New Guinean (Coastal)", "DQ372877": "Micronesia Majuro Atoll", "DQ372870": "Papua New Guinea: Trobriand Islands", "DQ372871": "Papua New Guinea: Trobriand Islands", "DQ372872": "Papua New Guinea: Trobriand Islands", "AY275529": "Senegal: Wolof", "DQ112777": "Sudan", "DQ112776": "Brazil", "AY519496": "Russia: Aldan", "DQ112774": "Brazil", "DQ112773": "Brazil", "AY738940": "Pakistan", "AY289089": "Papua New Guinean (Highland)", "AY738942": "Israel: Dimona", "AY289087": "Papua New Guinean (Highland)", "AY289086": "Papua New Guinean (Highland)", "AY289083": "Papua New Guinean (Coastal)", "AY289081": "Papua New Guinean (Coastal)", "DQ112778": "Sudan", "DQ981474": "Viet Nam: Kon Tum", "DQ981475": "Viet Nam: Kon Tum", "DQ981470": "Viet Nam: Kon Tum", "EF064341": "Italy", "DQ981472": "Malaysia", "DQ981473": "Thailand", "DQ112808": "Poland", "EF064327": "Iraq", "DQ112801": "Poland", "DQ112800": "Poland", "DQ112748": "Burkina Faso", "DQ112749": "Saudi Arabia", "DQ112742": "Burkina Faso", "DQ112743": "Burkina Faso", "AY963585": "Uganda", "DQ981467": "Indonesia: Sumatra, Padang", "DQ981466": "Indonesia: Sumatra", "DQ981465": "Indonesia: Tengger", "DQ902701": "Sweden: Vasterbotten", "DQ981468": "Indonesia: Sulawesi, Manado", "DQ902710": "Russia: Chelyabinsk region", "DQ902711": "Russia: Chelyabinsk region", "AY956412": "Papua New Guinea: West New Britain, Uasilau", "DQ112878": "China", "DQ112870": "America", "DQ112871": "America", "DQ112872": "America", "AY195790": "North Korea: Pyongyang", "DQ112755": "Australia", "EF060341": "Morocco: Marrakesh", "EF060343": "Egypt: Luxor", "DQ112751": "Australia", "EF060347": "Somalia", "AY882379": "Pakistan", "AY519494": "Russia: Aldan", "AY519495": "Russia: Aldan", "DQ902703": "Sweden: Vasterbotten", "DQ902702": "Sweden: Vasterbotten", "AY956413": "Papua New Guinea: New Ireland", "DQ902700": "Sweden: Norrbotten", "DQ902709": "Russia: Chelyabinsk region", "AY289102": "Tongan", "EF060330": "Greece: Athens", "EF060333": "USA: Pennsylvania", "EF060332": "Israel: Dimona"}';
var dict = JSON.parse(dictText);

var yearText = '{"DQ112922": "between 9600 and 20100 years", "AY289089": "between 20100 and 32800 years", "EF060350": "between 700 and 7700 years", "EF060355": "between 2100 and 11700 years ", "EF060354": "between 4 and 5000 years ", "DQ112720": "between 5300 and 12700 years ", "DQ112721": "between 12700 and 26900 years", "DQ112722": "between 11000 and 22700 years", "DQ981468": "between 1900 and 10100 years", "AY339533": "between 1700 and 5500 years", "AF381999": "between 4200 and 13700 years ", "AY339447": "between recent generations and 3800 years ago", "AY339446": "between recent generations and 3800 years ago", "AP008915": "between 900 and 8400 years ", "AY289058": "between 8700 and 24700 years ", "AY289059": "between 45700 and 58400 years", "DQ112850": "between 1432 and 7808 years ago", "DQ112851": "between 12700 and 24300 years", "AY289051": " between 29600 and 47700 years", "DQ112858": "between 8200 and 16600 years", "DQ112778": "between 37200 and 54200 years", "AY738992": "between 7900 and 10000 years", "AP008728": "between 2700 and 9700 years", "DQ902703": "between recent generations and 2500 years ago", "EF064333": "between 21300 and 28800 years", "AY738967": "between 200 and 6700 years", "EF060360": "between 7300 and 18600 years", "EF060361": "between 7300 and 18600 years", "AP008643": "between 2500 and 11600 years", "AY195753": "between 2100 and 8000 years", "AY275535": "between 21300 and 28800 years", "AY882401": "between 2000 and 6600 years", "DQ137398": "between 16200 and 28400 years", "DQ137399": "between 16200 and 28400 years", "AY738987": "between 7900 and 10000 years", "AY289098": "between 6400 and 20200 years", "DQ112761": "between 5200 and 13200 years", "AF382008": "between 19000 and 27400 years", "AF382009": "between recent generations and 3200 years ago", "AF381982": "between 1404 and 8400 years ago", "AF381981": "between 13200 and 22300 years", "AF382002": "between 4500 and 8100 years", "AF382003": "between 7700 and 13200 years", "AF382000": "between 3500 and 13700 years", "AF382001": "between 6500 and 11100 years ", "AF382006": "between 4900 and 9100 years", "AF382007": "between 6400 and 15700 years ", "AF382004": "between 12100 and 17700 years", "AF381989": "between recent years and 3800 years", "AY195762": "between 2148 and 12334 years ago(G1b)", "AY195763": "between 4400 and 9600 years", "DQ902700": "between 1700 and 5500 years", "DQ902695": "between recent generations and 2500 years ago", "DQ902694": "between 8400 and 11100 years", "EF064319": "between 9900 and 20000 years", "AY275530": "between 8300 and 19700 years", "AY275531": "between 19000 and 27400 years", "AY275532": "between 19000 and 27400 years", "AY275533": "between 19000 and 27400 years ", "AY882416": "between 9100 and 18700 years", "AY275536": "between 2700 and 12500 years", "AY275537": "between 2700 and 12500 years", "DQ112755": "between 39700 and 55700 years", "DQ112754": "between 39700 and 55700 years", "AY289074": "between 1400 and 9500 years ", "AY289075": "between 10800 and 25500 years(Q1)", "AY289072": "between 2000 and 8600 years", "AY289073": "between 6700 and 15600 years", "AY289070": "between 4100 and 11900 years ", "AY289071": "between 6600 and 16000 years", "EF064331": "between 3300 and 12500 years", "EF064330": "between 3300 and 12500 years", "AF382011": "between 5400 and 15600 years ", "AF382010": "between 8000 and 18000 years ago", "AF382013": "between 4000 and 18800 years", "AF382012": "between 13000 and 22200 years", "AY195773": "between 4200 and 9300 years", "EF064332": "between 7500 and 16600 years", "DQ372881": "between 7300 and 11800 years", "DQ112897": "between 52300 and 57300 years(P)", "DQ372883": "between 9000 and 19400 years", "AY963572": "between 2600 and 8700 years", "DQ372884": "between 10800 and 25500 years(Q1)", "AY738961": "between 2500 and 10400 years", "DQ372886": "between 7300 and 11800 years", "DQ137400": "between 9000 and 19400 years", "DQ137401": "between 9000 and 19400 years", "DQ137402": "between 41800 and 48800 years", "DQ137403": "between 41800 and 48800 years", "DQ137404": "between 41800 and 48800 years", "DQ137405": "between 41800 and 48800 years", "EF064328": "between 4600 and 15400 years", "DQ137407": "between 7600 and 20200 years", "DQ137408": "between 7600 and 20200 years", "DQ137409": "between 7600 and 20200 years", "EF064324": "between 21300 and 28800 years", "EF064336": "between 19000 and 27400 years", "AY275527": "between 8300 and 19700 years", "EF064323": "between 9100 and 18700 years", "EF064321": "between 3500 and 13200 years", "DQ112949": "between 21700 and 29800 years", "AY882389": "between 11000 and 23600 years", "AY289069": "between 7300 and 11800 years", "AY289068": "between recent generations and 6100 years ago", "AY882385": "between 10400 and 18500 years", "AY882383": "between 10200 and 19500 years", "EF060316": "between 9600 and 16300 years", "EF060315": "between 9600 and 16300 years", "EF060314": "between 9600 and 16300 years", "EF060313": "between 9600 and 16300 years", "EF060319": "between 2400 and 9100 years", "AY738952": "between 800 and 8900 years ", "AY738953": "between 8500 and 11300 years", "DQ112760": "between 5200 and 13200 years", "AY289099": "between 2600 and 8700 years", "DQ112762": "between 11600 and 18800 years", "DQ372880": "between 10036 and 19884 years", "AY289094": "between recent generations and 6100 years ago", "AY289095": "between 2800 and 15000 years ", "AY289096": "between 2800 and 15000 years ", "AY289093": "between recent generations and 6100 years ago", "AY255136": "between 36600 and 52200 years ", "AY255137": "between 6900 and 18900 years ago", "AY255134": "between 11000 and 15800 years", "DQ137410": "between 41800 and 48800 years ", "EF064335": "between 19000 and 27400 years", "EF064337": "between 19000 and 27400 years", "DQ372875": "between 7300 and 11800 years", "EF064339": "between 19000 and 27400 years ", "DQ372885": "between 10800 and 25500 years(Q1)", "DQ372874": "between 7300 and 11800 years", "AF381998": "between 12700 and 24300 years", "DQ372876": "between 13000 and 22200 years", "DQ372877": "between 7300 and 11800 years", "DQ372870": "between 52300 and 57300 years(P)", "DQ372871": "between 7300 and 11800 years", "DQ372872": "between 52300 and 57300 years(P)", "AY275529": "between 8300 and 19700 years", "AY519494": "between 14100 and 24500 years", "AY519495": "between 400 and 6700 years", "AY519496": "between recent generations and 10200 years ago", "DQ112774": "between 11800 and 18700 years", "DQ112773": "between 3400 and 12800 years", "AY738940": "between 3700 and 12100 years", "DQ112885": "between 10800 and 25500 years(Q1)", "AY738942": "between 11100 and 18500 years", "AY289087": "between 20000 and 32900 years", "AY289086": "between 23600 and 35800 years(P1d)", "AY289083": "between recent generations and 6100 years ago", "AY738948": "between 2300 and 9900 years", "AY289081": "between 10800 and 25500 years(Q1)", "AY289080": "between 7300 and 11800 years", "DQ981474": "between 576 and 6300 years ago", "DQ981475": "between 576 and 6300 years ago", "DQ112859": "between 6300 and 11300 years", "DQ981470": "between 1400 and 12300 years", "EF064341": "between 2500 and 8800 years ", "DQ981472": "between 1900 and 10100 years", "DQ981473": "between 1900 and 10100 years", "DQ112808": "between 17500 and 27400 years", "EF064327": "between 4600 and 15400 years", "DQ112801": "between 5900 and 9300 years", "DQ112800": "between 6500 and 11100 years ", "DQ137411": "between 41800 and 48800 years ", "DQ112748": "between 10800 and 17000 years ", "DQ112749": "between 5100 and 9100 years", "DQ112742": "between 10800 and 17000 years ", "DQ112743": "between 10800 and 17000 years ", "AY195787": "between 1100 and 7800 years", "DQ112896": "between 20100 and 32800 years", "AY963585": "between 1177 and 9577 years ago", "DQ981467": "between 1900 and 10100 years", "DQ981466": "between 1900 and 10100 years", "DQ981465": "between 1900 and 10100 years", "AY275528": "between recent generations and 5100 years ago", "DQ902701": "between recent generations and 2500 years ago", "AY738971": "between 1400 and 5700 years ago", "DQ902710": "between recent generations and 2500 years ago", "DQ902711": "between recent generations and 2500 years ago", "EF060329": "between 9600 and 16300 years ", "DQ112878": "between 400 and 6700 years", "AY195761": "between recent generations and 2500 years ago", "DQ112870": "between 7200 and 12100 years", "DQ112871": "between 13900 and 19700 years ", "DQ112872": "between 13900 and 19700 years ", "AY195790": "between 100 and 5800 years ", "EF060340": "between 12700 and 20800 years", "EF060341": "between 1600 and 11600 years", "EF060343": "between 4000 and 13600 years", "DQ112751": "between 48000 and 59000 years", "EF060347": "between 4900 and 15000 years", "AY882390": "between 3600 and 13600 years", "AY882379": "between 38300 and 47300 years", "AY956414": " between 9400 and 21200 years", "DQ112777": "between 6200 and 19400 years", "DQ112776": "between 11800 and 18700 years", "EF060362": "between 7300 and 18600 years ", "DQ902702": "between recent generations and 3800 years ago", "AY956413": " between 9400 and 21200 years", "AY956412": " between 9400 and 21200 years(Q2a)", "AY289100": "between 1400 and 8200 years", "DQ902709": "between recent generations and 2500 years ago", "AY289101": "between 27600 and 40800 years", "AY289102": "between 7300 and 11800 years", "EF060330": "between 9600 and 16300 years ", "EF060333": "between 5800 and 13800 years", "EF060332": "between 5800 and 13800 years"}';
var yearDict = JSON.parse(yearText);

var haploText = '{"DQ112922": "L5a1c", "AY289089": "Q3a1", "EF060350": "M1a5", "EF060355": "M1b2a", "EF060354": "M1b1a", "DQ112720": "L3e2b2", "DQ112721": "L3e2", "DQ112722": "L3e4", "DQ981468": "R9b1a1a", "AY339533": "U5b1b1a", "AF381999": "N1b1a", "AY339447": "V7a1", "AY339446": "V7a1", "AP008915": "G2a1c1", "AY289058": "O1a", "AY289059": "O", "DQ112850": "L0d2a1a", "DQ112851": "L3d3a1a", "AY289051": "S2", "DQ112858": "C7a2", "DQ112778": "L2a1", "AY738992": "H3", "AP008728": "M7a1a5a", "DQ902703": "Z1a1a", "EF064333": "U6a6b2", "AY738967": "H32", "EF060360": "M1b2", "EF060361": "M1b2", "AP008643": "M7a1a7", "AY195753": "C4a1a3a1", "AY275535": "U6a8a", "AY882401": "U5b1b1d", "DQ137398": "M28b", "DQ137399": "M28b1", "AY738987": "H3", "AY289098": "M7b1a2a1", "DQ112761": "K1a2a", "AF382008": "U6a7a2", "AF382009": "C1b2", "AF381982": "U3a1c", "AF381981": "L2c1a", "AF382002": "H1a", "AF382003": "W1", "AF382000": "U2d2", "AF382001": "J1d1b", "AF382006": "T1a1", "AF382007": "I5a1b", "AF382004": "U2e1c1", "AF381989": "U5b1b1e", "AY195762": "G1b4", "AY195763": "C4b2a", "DQ902700": "U5b1b1a3", "DQ902695": "Z1a1a", "DQ902694": "V", "EF064319": "U6a1a1", "AY275530": "U6b", "AY275531": "U6a7a1", "AY275532": "U6a7a1", "AY275533": "U6a7b1", "AY882416": "U6a2a2a", "AY275536": "U6c2", "AY275537": "U6c1", "DQ112755": "M42a", "DQ112754": "M42a", "AY289074": "M35a1a", "AY289075": "Q1c1a", "AY289072": "M30a1", "AY289073": "U1a1a", "AY289070": "E2a", "AY289071": "M30b", "EF064331": "U6a5a1", "EF064330": "U6a5a", "AF382011": "U7b", "AF382010": "A2q", "AF382013": "M30c", "AF382012": "M7c1c3", "AY195773": "X2c1", "EF064332": "U6a5c", "DQ372881": "B4a1a1", "DQ112897": "P2", "DQ372883": "M28a1", "AY963572": "F1a1a1", "DQ372884": "Q1f1", "AY738961": "H2b", "DQ372886": "B4a1a1", "DQ137400": "M28a7", "DQ137401": "M28a5b", "DQ137402": "M27b1", "DQ137403": "M27b1", "DQ137404": "M27b1", "DQ137405": "M27c", "EF064328": "U6a4", "DQ137407": "M29a", "DQ137408": "M29a", "DQ137409": "M29a", "EF064324": "U6a3f1", "EF064336": "U6a7a1", "AY275527": "U6b2", "EF064323": "U6a2a1", "EF064321": "U6a1b1a", "DQ112949": "L3d5", "AY882389": "U9a", "AY289069": "B4a1a1a", "AY289068": "B4a1a1m1", "AY882385": "U3b1a1", "AY882383": "U3a2a1", "EF060316": "M1a1a1", "EF060315": "M1a1a1", "EF060314": "M1a1a1", "EF060313": "M1a1a1", "EF060319": "M1a1b1a", "AY738952": "H5a2", "AY738953": "H5v", "DQ112760": "K1a2a", "AY289099": "F1a1a1", "DQ112762": "U4c1", "DQ372880": "Q1b", "AY289094": "B4a1a1k1", "AY289095": "F4b1", "AY289096": "F4b1", "AY289093": "B4a1a1a13", "AY255136": "B6a", "AY255137": "G1c1", "AY255134": "D4j", "DQ137410": "M27a1a1", "EF064335": "U6a7a1c", "EF064337": "U6a7a1b", "DQ372875": "B4a1a1x", "EF064339": "U6a7b1", "DQ372885": "Q1f1", "DQ372874": "B4a1a1x", "AF381998": "L3d3b", "DQ372876": "M7c1c3", "DQ372877": "B4a1a1x", "DQ372870": "P2", "DQ372871": "B4a1a", "DQ372872": "P2", "AY275529": "U6b", "AY519494": "B4b1a", "AY519495": "B4a1c2", "AY519496": "C1a", "DQ112774": "D1a1", "DQ112773": "D1e", "AY738940": "R0a2d", "DQ112885": "Q1c1a", "AY738942": "HV1b", "AY289087": "P1d1", "AY289086": "P1d2", "AY289083": "B4a1a1a1", "AY738948": "H1br", "AY289081": "Q1", "AY289080": "B4a1a1", "DQ981474": "R9b2", "DQ981475": "R9b2", "DQ112859": "U4a2g", "DQ981470": "R9b1b", "EF064341": "U6d1b", "DQ981472": "R9b1a1a", "DQ981473": "R9b1a1a", "DQ112808": "U5a", "EF064327": "U6a4", "DQ112801": "H7d", "DQ112800": "J1c1b", "DQ137411": "M27a1a1", "DQ112748": "L3b1a", "DQ112749": "H6a1a", "DQ112742": "L3b1a", "DQ112743": "L3b1a", "AY195787": "X2a2", "DQ112896": "Q3a", "AY963585": "L0f2a1", "DQ981467": "R9b1a1a", "DQ981466": "R9b1a1a", "DQ981465": "R9b1a1a", "AY275528": "U6b1a1", "DQ902701": "Z1a1a", "AY738971": "H1e2c", "DQ902710": "Z1a1a", "DQ902711": "Z1a1a", "EF060329": "M1a1", "DQ112878": "N9a2c", "AY195761": "Z1a2a", "DQ112870": "X2b3", "DQ112871": "D1", "DQ112872": "D1", "AY195790": "D4o2a", "EF060340": "M1a2", "EF060341": "M1a3a", "EF060343": "M1a3b2", "DQ112751": "S", "EF060347": "M1a4a", "AY882390": "U9b1", "AY882379": "U2a1a", "AY956414": "Q2a", "DQ112777": "L0a1b", "DQ112776": "D1a1", "EF060362": "M1b2c", "DQ902702": "V7a1", "AY956413": "Q2a", "AY956412": "Q2a3a", "AY289100": "B4c2a", "DQ902709": "Z1a1a", "AY289101": "B4c2", "AY289102": "B4a1a1", "EF060330": "M1a1", "EF060333": "M1a1e1", "EF060332": "M1a1e2"}';
var haploDict = JSON.parse(haploText);

var locToID = '{"Brazil": "DQ112776", "Canary Islands, Hierro": "AF382010", "Italy": "EF064341", "Mumbai": "AY289098", "Sudan": "DQ112777", "East New Britain, Watwat": "DQ137400", "Samoan": "AY289094", "South Bougainville": "DQ137405", "Cambodia": "AY963572", "France": "EF064339", "Ethiopia": "AY882389", "Sumatra": "DQ981466", "Somalia": "EF060347", "Manila": "AF382012", "Vanuatu": "DQ372881", "Southern India": "AY289072", "Canary Islands, Tenerife": "AF382009", "Nigeria": "EF064330", "Marrakesh": "EF060361", "Norway": "DQ112760", "Burkina Faso": "DQ112748", "Cook Islands": "DQ372884", "Vasterbotten": "DQ902703", "East New Britain": "DQ137402", "Saudi Arabia": "DQ112749", "Australia": "DQ112755", "Kon Tum": "DQ981474", "Algeria": "EF064321", "Wolof": "AY275529", "Filippines": "AY289070", "Trobriand Islands": "DQ372872", "Jordan": "AF382000", "Papua New Guinea": "AY289075", "Micronesia Majuro Atoll": "DQ372876", "Siwa": "EF060315", "Sardinia": "EF064335", "Tongan": "AY289102", "Kannada": "AY289071", "Germany": "AY195773", "Galicia": "AY275530", "China": "DQ112859", "Dominican Republic": "DQ112720", "America": "DQ112870", "Norrbotten": "DQ902700", "Spain": "AF382011", "Mauritania": "AY275531", "Tonga": "DQ372886", "Georgia": "AY738992", "New Britain": "DQ137404", "West New Britain, Uasilau": "AY956412", "DR Congo": "DQ112922", "Iraq": "EF060362", "Poland": "DQ112808", "Finland": "AY339533", "Athens": "EF060330", "New Ireland": "AY956413", "Sulawesi, Manado": "DQ981468", "Micronesia": "DQ372875", "Southern Indian": "AY289074", "West New Britain ": "DQ137398", "Dimona": "EF060354", "Yemen": "AY882385", "Luxor": "EF060343", "Thailand": "DQ981473", "Aldan": "AY519494", "Pakistan": "AY882379", "Sumatra, Padang": "DQ981467", "Samoa": "DQ372885", "Papua New Guinean (Coastal)": "AY289081", "East New Britain, Malasait": "DQ137401", "Tunisia": "EF064331", "India": "AF382013", "Leon": "AF382006", "Tengger": "DQ981465", "Malaysia": "DQ981472", "Cook Islander": "AY289069", "Uganda": "AY963585", "Pyongyang": "AY195790", "Canary Islands": "AY275533", "Japan": "AP008643", "Pennsylvania": "EF060333", "Chelyabinsk region": "DQ902710", "Papua New Guinean (Highland)": "AY289089"}';
var locToIDict = JSON.parse(locToID);

var yearLocationDict = {};
var haploTypeDict = {};

var files = ['test']
var colors = ['green', 'red', 'blue', 'yellow', 'purple', 'orange']

var requestNames= []
var requestLocation = {};

var tags = {};
var clusterArr = []

var map;
var allDrawing = [];
var checked = 0;

var findCount = 0;

function translateLabel(key){
  console.log(key);
  var location = dict[key.trim()];
  console.log(location);
  if(location){
    findCount ++;
  }
  return location;
}

function SwitchControl(selector, map){
  for(var i=0; i<files.length; i++){
    var option = document.createElement("option");
    option.text = i;
    selector.add(option);
  }
  
  selector.addEventListener("change", function(e){
    console.log(allDrawing.length);
    for(var i=0; i<allDrawing.length; i++){
      allDrawing[i].setMap(null);
    }
    allDrawing = [];
  })
}

// function readExternalFile(fileList){
//   for(let i=0; i<fileList.length; i++){
//     var rawFile = new XMLHttpRequest();
//     rawFile.open("GET", fileList[i], false);
//     rawFile.onreadystatechange = function ()
//     {
//         if(rawFile.readyState === 4)
//         {
//             if(rawFile.status === 200 || rawFile.status == 0)
//             {
//                 var allText = rawFile.responseText;
//                 fetchFile(allText);
//             }
//         }
//     }
//     rawFile.send(null);
//   }
// }

function fetchFile(fileText){
  //var text = fileText.replace(new RegExp('(:\-?\\d.\\d+)|\\n','g'), '');
  //console.log(text);
  //var text = "(EF064339,((EF060330,(EF060362,AF382000)),AY882385),EF060316,(AY339447,DQ902703),(DQ112760,DQ981473),DQ112755,)";
  var text = "(((((((((AY289073,((((((((((AY289069,AY289093),AY289080),DQ372886),AY289094),DQ372881),AY289102),AY289083),(DQ372874,DQ372875)),AY519495),AY519494)),AY289087),(((((AF381998,DQ112851),DQ112949),(((DQ112850,(AY963585,DQ112777)),DQ112922),(DQ112778,AF381981))),((AY289059,AF382010),(AF382007,AF381999))),(DQ112748,(DQ112742,DQ112743)))),(DQ112722,(DQ112720,DQ112721))),((((((((((AY289071,AF382013),((DQ137398,DQ137399),((DQ137401,DQ137400),DQ372883))),((((DQ137409,DQ137407),DQ137408),((((EF060350,EF060347),(EF060341,EF060343)),((((EF060313,(EF060316,EF060314)),EF060315),(((EF060329,EF060330),(EF060319,EF060333)),EF060332)),EF060340)),((((EF060362,EF060361),EF060355),EF060360),EF060354))),(DQ137411,DQ137410))),((((AY956414,AY956413),AY956412),(((((DQ372885,DQ372884),AY289081),AY289075),DQ372880),DQ112885)),(AY289089,DQ112896))),(((((AP008643,AP008728),AY289098),(DQ372876,AF382012)),(AP008915,(AY255137,AY195762))),((AY195761,(((DQ902695,DQ902703),DQ902701),(DQ902709,(DQ902710,DQ902711)))),(((AF382009,AY519496),(AY195753,AY195763)),DQ112858)))),(((DQ137404,DQ137402),DQ137403),DQ137405)),DQ112754),DQ112755),((AY289074,AY289072),AY289070)),(((((AY255134,AY195790),DQ112773),DQ112872),DQ112871),(DQ112776,DQ112774)))),(AY255136,(((AY289068,DQ372877),DQ372871),(AY289100,AY289101)))),((((AY963572,AY289099),(AY289095,AY289096)),DQ112878),((DQ981474,DQ981475),(DQ981470,(((DQ981465,(DQ981468,DQ981466)),(DQ981467,DQ981472)),DQ981473))))),((((AY195773,AY195787),DQ112870),AY289058),((AF382003,DQ112751),AY289051))),((((((((AY882416,EF064323),(AY275535,(EF064324,EF064319))),((EF064321,((EF064331,EF064330),EF064332)),(EF064328,EF064327))),(((EF064339,AY275533),EF064333),(AF382008,((((AY275532,AY275531),EF064337),EF064336),EF064335)))),((AY275527,EF064341),((AY275529,AY275528),AY275530))),((AY275536,AY275537),(DQ112760,DQ112761))),((((AY882401,DQ902700),AF381989),AY339533),DQ112808)),(((((DQ112762,DQ112859),(AY882390,AY882389)),AY882379),(AF382004,AF382000)),(((AF381982,AY882383),AY882385),AF382011))),((((AF382001,DQ112800),AF382006),(AY289086,((DQ372872,DQ372870),DQ112897))),(AY738940,((((DQ902702,(AY339447,AY339446)),DQ902694),AY738942),(((((AY738948,AY738961),((AY738952,AY738953),(AY738992,AY738987))),DQ112801),((AY738971,AF382002),AY738967)),DQ112749)))),)";

  var tmpStr = "";
  var lvBrace = 0;
  var colorCount = 0;
  var flag = true;

  for(var i=0; i<text.length; i++){
    if(text[i] == "("){
      lvBrace ++;
      if(lvBrace == 2){
        flag = true;
      }
    }else if(text[i] == ")"){
      lvBrace --;
    }else if(text[i] == ","){
      var translated = translateLabel(tmpStr);
      if(translated){
        if(yearDict[tmpStr.trim()]){
          yearLocationDict[tmpStr.trim()] = yearDict[tmpStr.trim()];
        }

        if(haploDict[tmpStr.trim()]){
          haploTypeDict[tmpStr.trim()] = haploDict[tmpStr.trim()];
        }

        requestNames.push(translated);

        if(clusterArr.length==0 || (lvBrace==1&&text[i-1]!=")")){
          clusterArr.push([translated]);
          //clusterArr.push(tmpStr);
        }else{
          if(flag){
            clusterArr.push([translated]);
            //clusterArr.push(tmpStr)
            flag = false;
          }else{
            clusterArr[clusterArr.length-1].push(translated);
            //clusterArr[clusterArr.length-1].push(tmpStr);
          }
        }
      }
      tmpStr="";
    }else{
      tmpStr+=text[i];
    }
  }
  console.log(yearLocationDict);
  console.log(clusterArr);
}

function initMap() {
  //readExternalFile(files);
  fetchFile();
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 20, lng: 120},
    zoom: 3
  });

  var service = new google.maps.places.PlacesService(map);
  // var requestNames = [];
  // for(let tagName of Object.keys(requestLocation)){
  //     requestNames.push(tagName);
  // }

  var requestCount = 0;
  var upperBound = 0;
  var reqTimeout =setInterval(function(){
    upperBound = Math.min(requestCount+1, requestNames.length+1);
    for(var i = requestCount; i<upperBound; i++){
      var request = {
        location: map.getCenter(),
        radius: '5000',
        query: requestNames[i]
      };
      service.textSearch(request, callback);
    }
    requestCount = Math.min(requestCount+1, requestNames.length+1);
    if(requestCount>=requestNames.length){
      clearInterval(reqTimeout);
      drawOnMap();
    }
  }, 500);
}

function callback(results, status) {
  if (status == google.maps.places.PlacesServiceStatus.OK) {
    var index = 0;
    for(var i=0; i<clusterArr.length; i++){
      if(clusterArr[i].indexOf(results[0]['name'])>=0){
        index = i;
        break;
      }
    }
    
    var marker = new google.maps.Marker({
      //icon : 'http://maps.google.com/mapfiles/ms/icons/'+tags[results[0]['name']]['color']+'-dot.png',
      icon : 'http://maps.google.com/mapfiles/ms/icons/'+colors[index]+'-dot.png',
      //icon : './people.png', 
      map: map,
      place: {
        placeId: results[0].place_id,
        location: results[0].geometry.location
      }
    });
    console.log(locToIDict[results[0]['name']]);
    var contentStr = "<div>"+results[0]['name']+"</div><div>"+yearLocationDict[locToIDict[results[0]['name']]]+"</div>"+"<div>HaploType: "+haploTypeDict[locToIDict[results[0]['name']]]+"</div>"
    var infoWindow = new google.maps.InfoWindow({
      content: contentStr
    })
    
    google.maps.event.addListener(marker, 'click', function() {
      infoWindow.open(map, marker);
    });

    // marker.addEventListener('click', function(){
    //   console.log(111);
    //   infoWindow.open(map, marker);
    // })
    allDrawing.push(marker);

    //tags[results[0]['name']]['marker'] = marker;
  }
  checked++;
}

function drawOnMap(){
  var interval = setInterval(function(){
    if(checked == Object.keys(tags).length){
      //console.log(google.maps.geometry.spherical.computeDistanceBetween(tags["China"]["marker"]["place"]["location"], tags["Japan"]["marker"]["place"]["location"]))
      clearInterval(interval);
    }
  }, 1000);

  var switchControlBox = document.createElement('select');
  var switchControl = new SwitchControl(switchControlBox, map);

  switchControlBox.index = 1;
  map.controls[google.maps.ControlPosition.TOP_CENTER].push(switchControlBox);
}